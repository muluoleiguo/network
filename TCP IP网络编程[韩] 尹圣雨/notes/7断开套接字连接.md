TCP的断开连接过程比连接建立更为重要，需要掌握半关闭（half-close）

**单方面断开连接带来的问题**

Linux的close函数意味着完全断开连接，收发都是没有办法的，

**半关闭**：可发不可收、或者可收不可发

**套接字和流（Stream）**

建立套接字后可交换数据的状态看作一种流

如同水流一样，为了进行双向通信，需要单独的输入流和输出流。



**优雅断开的shutdown函数**

```c
#include<sys/socket.h>
int shutdown(int sock,int howto);

```

howto:传递断开方式信息

| SHUT_RD   | 断开输入流    |
| --------- | ------------- |
| SHUT_WR   | 断开输出流    |
| SHUT_RFWR | 同时断开I/O流 |

断输入流即使输入缓冲收到数据也会抹去

但断开输出流，如果输出缓冲留有未传输的数据，会传递至目标主机。

同时断开相当于两次调用



为什么半关闭，服务器在断开输出流的时候向对方传递EOF表示文件传输结束，保留输入流还可接受客户端的反馈。



![image-20210118205906538](C:\Users\55018\AppData\Roaming\Typora\typora-user-images\image-20210118205906538.png)