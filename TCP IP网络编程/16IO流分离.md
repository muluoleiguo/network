“流”分离目的。

* 通过分开输入过程（代码）和输出过程降低实现难度。
* 与输入无关的输出操作可以提高速度。



* 为了将FILE指针按读模式和写模式加以区分。
* 可以通过区分读写模式降低实现难度。
* 通过区分I/O缓冲提高缓冲性能。



## 文件描述符的复制和半关闭

终止“流”时无法半关闭的原因
图16-1描述的是sep_serv.c示例中的2个FILE指针、文件描述符及套接字之间的关系

![image-20210120175109462](C:\Users\55018\AppData\Roaming\Typora\typora-user-images\image-20210120175109462.png)

读模式FILE指针和写模式FILE指针都是基于同一文件描述符创建的。因此，针对任意一个FILE指针调用fclose函数时都会关闭文件描述符，也就终止套接字，

那如何进人可以输人但无法输出的半关闭状态呢？其实很简单。如图16-3所示，创建FILE指针前先复制文件描述符即可。

![image-20210120175148193](C:\Users\55018\AppData\Roaming\Typora\typora-user-images\image-20210120175148193.png)



**复制文件描述符**

调用fork函数时将复制整个进程，因此同一进程内不能同吋有原件和副本。但此处讨论的复制并非针对整个进程，而是在同一进程内完成描述符的复制

![image-20210120175305163](C:\Users\55018\AppData\Roaming\Typora\typora-user-images\image-20210120175305163.png)

“**复制**”:为了访问同一文件或套接字，创建另一个文件描述符

```C
#include<unistd.h>

int dup(int fildes);
int dup2(int fildes,int fildes2)
    
```

fildes:需要复制的文件描述符。
fildes2:明确指定的文件描述符整数值。

dup2函数明确指定复制的文件描述符整数值。向其传递大于0且小于进程能生成的最大文件描述符值时，该值将成为复制出的文件描述符值。

